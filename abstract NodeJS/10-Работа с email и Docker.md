Пакет Nodemailer
Общие сведения
Nodemailer - это единый модуль с нулевыми зависимостями для Node.js, предназначенный для отправки электронных писем. Его основные функции включают (но не ограничиваются ими):

независимость от платформы
безопасность, в частности, доставка электронной почты с TLS / STARTTLS и DKIM аутентификацией электронной почты
Поддержка Unicode
HTML-контент и вложенные изображения
различные транспортные методы помимо поддержки SMTP.
Единственное, что требуется для начала использования Nodemailer, - это Node.js версии 6.0 или выше. Вам также следует установить сам Nodemailer. Выполните следующую команду в командной строке Node.js:

npm install nodemailer

Nodemailer предлагает готовые встроенные транспорты отправки сообщений

sendmail , обычная команда sendmail для простых сообщений.
SES , чтобы обрабатывать большой трафик электронных писем, отправляя их с помощью Amazon SES.
stream , буфер для тестирования, для возврата сообщений.
Но так же мы можем создать свой собственный способ транспортировки - это называется внешний транспорт.

Настройка почтового ящика
SMTP является наиболее распространенным транспортером, и мы будем использовать его в своем примере при отправке писем. Для этого мы будем использовать сервис почты с портала Meta.ua. С его помощью мы сможем проверить работоспособность нашего приложения. Даже если у вас еще нет учетной записи, весь процесс настройки займет всего пару минут. После того как мы зарегистрируем свою почту. Необходимо настроить ее, чтобы, Nodemailer смог с ней работать. То есть выставить определенные разрешения.

СНОСКА
Может возникнуть вопрос почему мы не используем gmail сервис. Ну во первых примеров, в интернете для gmail сервиса много. И второе в последнее время политика безопасности сервиса не приветствует использование сторонних приложений при доступе к почте.

Первое нам надо пойти в настройки почты

settings

Выбрать настройку POP3/SMTP сервера

settings

И выставить разрешения, пункт два или три

settings

При отправке писем через SMTP-сервер meta.ua накладываются следующие ограничения:

Письмо должно быть не более 30Мб. Напоминаем, что при передаче писем по стандарту вложенные файлы кодируются в base64, при этом размер вложенного файла увеличивается в среднем в 1,5 раза.
Нельзя отправлять письмо более 10 получателям (включая копии и скрытые копии письма)
В целях борьбы с Спам-распространением не допускается отправлять более 200 писем в день.
Настройки почтовых программ (POP3-клиентов) для работы с Вашей ящиком на meta.ua: Сервер входящей почты (POP3) pop.meta.ua порт 995 Сервер исходящей почты (SMTP) smtp.meta.ua порт 465 Аутентификация SMTP Обязательно (как для POP3) Защищенное соединение TLS / SSL

Отправка письма
Все мы обладаем всем необходимым, чтобы Nodemailer смог подключиться к нашей почте и начать отправку писем. Чтобы отправить сообщение с помощью Nodemailer, нужно выполнить три основных шага.

Шаг первый
Необходимо создать транспортер Nodemailer В переменной config мы указываем основные параметры и создаем транспорт переменную transporter

Шаг второй
Установите параметры сообщения Nodemailer На этом этапе мы должны указать отправителя, получателей сообщения и содержимое нашего сообщения. Что мы делаем в переменной emailOptions

Шаг третий
Отправьте сообщение с помощью sendMail() Создав транспортер и настроив сообщение, мы можем отправить его с помощью метода sendMail() :

Полный код примера отправки письма:

const nodemailer = require('nodemailer');

require('dotenv').config();

const config = {
  host: 'smtp.meta.ua',
  port: 465,
  secure: true,
  auth: {
    user: 'goitnodejs@meta.ua',
    pass: process.env.PASSWORD,
  },
};

const transporter = nodemailer.createTransport(config);
const emailOptions = {
  from: 'goitnodejs@meta.ua',
  to: 'noresponse@gmail.com',
  subject: 'Nodemailer test',
  text: 'Привет. Мы тестируем отправку писем!',
};

transporter
  .sendMail(emailOptions)
  .then(info => console.log(info))
  .catch(err => console.log(err));

Если отправка письма прошла успешно мы должны получить в консоли ответ похожий на следующий. Фактически произошла отправка с email goitnodejs@meta.ua, на адресс noresponse@gmail.com, который хранится в поле emailOptions.to

{
  accepted: [ 'noresponse@gmail.com' ],
  rejected: [],
  envelopeTime: 41,
  messageTime: 56,
  messageSize: 361,
  response: '250 OK id=1kDSBb-0003Z5-IB',
  envelope: { from: 'goitnodejs@meta.ua', to: [ 'noresponse@gmail.com' ] },
  messageId: '<9848972a-ae4d-8b56-c6f6-c645a84139c9@meta.ua>'
}

Чтобы отправить текст в формате HTML, никаких дополнительных атрибутов не требуется, просто вставьте текст HTML в сообщение с атрибутом html вместо атрибута text.

Здесь вы можете ознакомиться с примером.


Простая форма позволяющая отправить письмо на указанный адрес. У нас есть форма для отправки сообщения, она принимает имя, email куда надо отправить письмо, и поля для текстового сообщения. При успешной отправке будет отрендерен шаблон done. Проверьте работоспособность приложения и отправьте себе письмо, с адреса goitnodejs@meta.ua

INFO
Помните, что каждый день можно отправить не больше 200 писем, не злоупотребляйте отправкой при проверке :)

Сервис SendGrid
При отправке писем, через пакет nodemailer мы можем столкнутся с определенными трудностями. Это и попадание наших писем в папку спама и отклонения почтовыми серверами наших сообщений. Мы ограничены пропускной способностью сервиса через который мы отправляем наши письма. Ограничение на обрабатывание больших объемов, в нашем случае сервис meta.ua предоставляет отправку только 200 писем в день. Возникают проблемы аналитики, отслеживание email производительности, чтения писем пользователями, достигли ли письма их назначения и т.д. и т.п.

Выход в основном использовать стороннюю службу рассылки, которая возьмет на себя, решение указанных проблем. На рынке предлагается достаточно много сервисов для рассылок и отправок писем. Это и популярный Amazon Simple Email Service и Mailgun перечислять их можно долго. У всех есть свои преимущества и средства SDK для разработчиков. Для демонстрации мы выберем популярный сервис SendGrid от компании Twilio

Регистрируемся в сервисе (при регистрации можно указать любую компанию). После регистрации перейдите в меню Settings и выберите API Keys. Нажмите кнопку Create API Key. Укажите имя ключа и создайте. В появившемся окне вы увидите API key. Скопируйте себе его (кликните мышкой по ключу) и запомните, он пригодится вам для выполнения домашнего задания.

В принципе мы готовы отправлять письма. Достаточно подробная документация поможет нам в этом прочтите ее

Нам необходимо только установить библиотеку

npm install --save @sendgrid/mail

Сама отправка тривиальна

const sgMail = require('@sendgrid/mail');
sgMail.setApiKey(process.env.SENDGRID_API_KEY);

const msg = {
  to: 'test@example.com',
  from: 'test@example.com',
  subject: 'Sending with SendGrid is Fun',
  text: 'and easy to do anywhere, even with Node.js',
  html: '<strong>and easy to do anywhere, even with Node.js</strong>',
};

sgMail
  .send(msg)
  .then(() => {
    console.log('Email sent');
  })
  .catch(error => {
    console.error(error);
  });

В переменной окружения SENDGRID_API_KEY мы будем хранить API key который мы заранее создали. В объекте msg поле to поставьте действующий адрес электронной почты,куда мы хотим доставить ваше сообщение. Измените from значение на адрес, который вы указали во время регистрации. Чтобы отправить сообщение, передайте этот объект в качестве аргумента метода send() экземпляра библиотеки sgMail

Так же можете ознакомиться с работающим примером. Это предыдущий пример для отправки писем, но использует он сервис SendGrid, а не пакет Nodemailer


INFO
Ограничение по отправке писем, для бесплатного плана, у SendGrid еще жестче, всего 100 писем в день

Docker
Docker - это платформа, которая позволяет «создавать, поставлять и запус­кать любое приложение повсюду». За невероятно короткое время она прошла большой путь и теперь считается стандартным способом решения одного из самых дорогостоящих аспектов программного обеспечения - развертывания.

Контейнеры
Контейнеры коренным образом изменяют способ разработки, распространения и функционирования программного обеспечения. Разработчики могут создавать программное обеспечение на локальной системе, точно зная, что оно будет работать одинаково в любой операционной среде Контейнеры (containers) представляют собой средства инкапсуляции приложения вместе с его зависимостями.

В основу Docker была заложена существующая технология Linux-контейнеров с разнообразными обертками и расширениями - в основном использующими переносимые образы и удобный для пользователя интерфейс - для создания полностью готового к применению решения, обеспечивающего создание и распространение контейнеров.

Платформа Docker состоит из двух отдельных компонентов: Docker Engine, механизма, отвечающего за создание и функционирование контейнеров, и Docker Hub, облачного сервиса для распространения контейнеров (некий аналог GitHub).

На первый взгляд контейнеры могут показаться всего лишь упрощенной формой виртуальных машин, но несмотря на то, что контейнеры и виртуальные машины на первый взгляд кажутся похожими, между ними существуют важные различия, которые проще всего продемонстрировать на графических схемах

virtual

Три виртуальные машины, работающие на одном хосте

container

Три контейнера, работающих на одном хосте

В отличие от виртуальных машин, ядро хоста (Host OS) совместно используется (разделяется) работающими контейнерами. Это означает, что контейнеры всегда ограничиваются использованием того же ядра, которое функционирует на хосте.

Установка
Докер поставляется в виде Community Edition (CE) и Enterprise Edition (EE), мы будем использовать CE. На главной странице доступны ссылки для скачивания Docker Desktop под все популярные платформы. Выберите вашу и установите Докер.

Чтобы убедиться в правильности установки и работоспособности программной среды Docker, следует выполнить команду docker version. Эта команда должна выдать информацию, похожую на приведенную ниже:

Client: Docker Engine - Community
 Cloud integration: 1.0.12
 Version:           20.10.5
 API version:       1.41
 Go version:        go1.13.15
 Git commit:        55c4c88
 Built:             Tue Mar  2 20:14:53 2021
 OS/Arch:           windows/amd64
 Context:           default
 Experimental:      true

Server: Docker Engine - Community
 Engine:
  Version:          20.10.5
  API version:      1.41 (minimum version 1.12)
  Go version:       go1.13.15
  Git commit:       363e9a8
  Built:            Tue Mar  2 20:15:47 2021
  OS/Arch:          linux/amd64
  Experimental:     false
 containerd:
  Version:          1.4.4
  GitCommit:        05f951a3781f4f2c1911b05e61c160e9c30eaa8e
 runc:
  Version:          1.0.0-rc93
  GitCommit:        12644e614e25b05da6fd08a38ffa0cfe1903fdec
 docker-init:
  Version:          0.19.0
  GitCommit:        de40ad0

Зачем нужен Docker
Главная причина Docker &mdash экономит бизнесу много денег. Но перечислим все же более подробно основные причины использования:

Замена виртуальных машин
Прототипирование программного обеспечения
Упаковка программного обеспечения
Возможность для архитектуры микросервисов
Моделирование сетей
Возможность производительности полного стека в автономном режиме
Сокращение неизбежных расходов на отладку
Документирование зависимостей программного обеспечения
Возможность непрерывной доставки
Архитектура и компоненты Docker
В Docker используется архитектура клиент/сервер, в соответствии с которой клиент взаимодействует с демоном Docker, а тот предоставляет все необходимые клиенту услуги. Рассмотрим компоненты составляющие экосистему Docker:

сервер, или демон Docker. Выполняется в хост-системе и управляет всеми запущенными контейнерами;
контейнер Docker. Автономная виртуальная система, содержащая выполняющийся процесс, все файлы, зависимости, адресное пространство процесса и сетевые порты, необходимые приложению. Так как каждый контейнер имеет свое пространство портов, следует организовать их отображение в фактические порты на уровне Docker;
клиент Docker. Пользовательский интерфейс, или интерфейс командной строки, для взаимодействий с демоном Docker;
образы Docker. Шаблонные файлы, доступные только для чтения, с контейнером Docker. Их можно перемещать и передавать. В отличие от виртуальных машин, эти файлы можно хранить в системе управления версиями;
реестр Docker. Репозиторий для хранения и  распространения образов контейнеров Docker. Пример Docker Hub (аналог GitHub), куда можно помещать и откуда можно извлекать образы. Организации могут организовать свой реестр;
файл Dockerfile. Это очень простой текстовый файл, содержащий коман- ды, которые выполняют сборку образов Docker;
Docker Machine. Устанавливает и конфигурирует Docker-хосты на локальных и удаленных ресурсах. Кроме того, Machine конфигурирует клиента Docker, упрощая процедуру переключения между средами. За самой свежей информацией по этой теме обращайтесь к официальной онлайн-документации Docker;
Docker Swarm. По сути своей, это готовый к использованию механизм кластеризации, позволяющий объединить несколько узлов Docker в один большой хост Docker.
Docker Compose. Инструмент для создания и выполнения приложений, скомпонованных из нескольких Docker-контейнеров. Такие компоновки используются главным образом при разработке и тестировании, но гораздо реже в производственной среде.
Ключевые команды Docker
Основная функция Docker – создавать, отправлять и запускать программное обеспечение в любом месте, где есть Docker. Для пользователя, чаще всего Docker – это программа c командной строкой, которую они запускают. Как и любой другой инструмент управления исходным кодом вроде и  git, у  этой программы есть подкоманды, которые выполняют различные операции. Перечислим их.

Основные подкоманды Docker.

Команда	Назначение
docker pull	Загрузить образ Docker
docker run	Запустить образ Docker в качестве контейнера
docker commit	Сохранить контейнер Docker в качестве образа
docker ps	Вывести список контейнеров
docker pull
Команда docker pull загружает указанный образ из реестра Docker на локальный компьютер:

docker pull image:tag

Например, чтобы загрузить образ MySQL надо выполнить следующую команду.

docker pull MySQL

Примечание: Если тег (tag, обозначающий версию) не указан, команда подставит тег "latest" и загрузит только последнюю версию образа MySQL. Фактически выполнилась команда docker pull MySQL:latest

docker run
После загрузки образа (командой pull) необходимо выполнить его запуск командой docker run:

docker run [options] image: tag [command, args]

Данная команда разворачивает контейнер в его собственной файловой системе, имеющей свой набор портов и IP-адрес. Кроме названия образа, команде run можно также передать дополнительные ключи и аргументы. Наиболее часто используемые из них:

i переключает команду в интерактивный режим и открывает STDIN;
t создает псевдотерминал tty
d запускает процесса в фоновом режиме, когда контейнер запускается без поддержки командной строки
docker ps
Команда docker ps выводит список всех контейнеров, запущенных к настоящему моменту:

docker ps [options]

Если выполнить команду ps с ключом –a, мы увидим список всех контейнеров, даже не запущенных

docker commit
Команда позволяет создать новый образ со всеми изменениями, выполненными в контейнере:

docker commit [options] container [repository:tag]

Если, выполнив какие-то изменения в  контейнере, вы решите передать его кому-то, например группе разработки или тестирования, в виде образа, то смо- жете создать такой образ из запущенного контейнера.

С полным перечнем команд можно познакомиться в документации

Учебник. Начало работы с Docker
Для более глубокого изучения рекомендуем бесплатный курс от Microsoft

