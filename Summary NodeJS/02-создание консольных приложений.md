Создание консольных приложений
Традиционный способ управления консольным приложением (CLI applications) - передача параметров из консольной строки при его запуске. Сокращение CLI (command-line interface) переводится как 'интерфейс командной строки'

Выше мы отмечали, что переданные параметры при запуске скрипта доступны в массиве process.args: ["node", "/…/youscript.js", "param 1", "param 2", …]. И чтобы получить эти параметры надо выполнить process.argv.slice(2), который вернет все разделенные пробелами параметры: ["param 1", "param 2", …]

Но обрабатывать всевозможные комбинации параметров и их форматы крайне неудобно, для этих целей обычно используют сторонние npm-модули. Один из популярных, который мы будем использовать - это модуль commander

Чтобы использовать интерактивный ввод в консоли по типу вопрос-ответ, мы будем использовать стандартный модуль Node.js readline. Инициализация достаточно проста:

const readline = require('readline');
const rl = readline.createInterface({
  input: process.stdin, // ввод из стандартного потока
  output: process.stdout, // вывод в стандартный поток
});

Мы подключаем модуль и создаем экземпляр rl где в опциях передаем потоки ввода и вывода, консоль, файл и т.д. В нашем случае мы берем стандартные потоки и будем работать в консоли где запускаем скрипт. Обработка каждой введенной строки происходит через событие line:

rl.on('line', cmd => {
  console.log(`You just typed: ${cmd}`);
});

Но нас больше интересует возможность задать пользователю вопрос и получить на него ответ, аналогично функции prompt из браузера:

rl.question('Как вас зовут?', answer => {
  console.log(`Приятно познакомиться ${answer}`);
});

Так же при какой-то длительной операции мы можем поставить разговор на паузу или другими словами заблокировать ввод:

rl.pause();

Чтобы закрыть интерфейсом readline необходимо выполнить функцию:

rl.close();

А теперь напишем приложение – «Угадай число», где необходимо угадать задуманное программой число от 1 до 10 и программа в конце выведет, за сколько попыток нам это удалось.

Нам понадобятся стандартные модули fs, readline и нестандартные, а значит, их надо установить с помощью npm, модуль commander и colors. Ниже листинг программы и ее разбор.

const readline = require('readline');
const fs = require('fs').promises;
const { program } = require('commander');
require('colors');
program.option(
  '-f, --file [type]',
  'file for saving game results',
  'results.txt',
);
program.parse(process.argv);

const rl = readline.createInterface({
  input: process.stdin,
  output: process.stdout,
});

let count = 0;
const logFile = program.opts().file;
const mind = Math.floor(Math.random() * 10) + 1;

const isValid = value => {
  if (isNaN(value)) {
    console.log('Введите число!'.red);
    return false;
  }
  if (value < 1 || value > 10) {
    console.log('Число должно быть в диапазоне 1 до 10'.red);
    return false;
  }
  return true;
};

const log = async data => {
  try {
    await fs.appendFile(logFile, `${data}\n`);
    console.log(`Удалось сохранить результат в файл ${logFile}`.green);
  } catch (err) {
    console.log(`Не удалось сохранить файл ${logFile}`.red);
  }
};

const game = () => {
  rl.question(
    'Введите число от 1 до 10, чтобы угадать задуманное: '.yellow,
    value => {
      let a = +value;
      if (!isValid(a)) {
        game();
        return;
      }
      count += 1;
      if (a === mind) {
        console.log('Поздравляю Вы угадали число за %d шага(ов)'.green, count);
        log(
          `${new Date().toLocaleDateString()}: Поздравляю Вы угадали число за ${count} шага(ов)`,
        ).finally(() => rl.close());
        return;
      }
      console.log('Вы не угадали еще попытка'.red);
      game();
    },
  );
};

game();

Вся программа состоит из трех функций. Основная функция это функции игры game(), которая вызывает себя рекурсивно до тех пор пока мы не угадаем задуманное число. Вначале мы подключаем модуль colors, который позволяет нам раскрашивать текст в консоли в разнообразные цвета Дальше подключаем модуль commander, это полноценное решение для создания интерфейсов командной строки:

const { program } = require('commander');
program.option(
  '-f, --file [type]',
  'file for saving game results',
  'results.txt',
);
program.parse(process.argv);

Мы указываем, что опционально ждем ввода параметра -f или более длинная запись --file. Другими словами мы определяем запуск программы в следующем в виде

node game.js -f my_log.txt

Мы указываем, что необходимо, в program.file положить значение my_log.txt, но в тоже время мы указываем, третьим параметром program.option, что если параметр -f не будет передан в запуске, то по умолчанию program.file будет равно results.txt

Дальше мы выполняем инициализацию модуля readline. Вводим три переменные которые мы будем в дальнейшем использовать: count - это подсчет количества попыток которые понадобились, чтобы угадать число, logFile - имя файла куда будут сохранены результаты игры, mind - это случайное число от 1 до 10, которое необходимо отгадать.

Функция isValid отвечает за валидацию введенных значений в консоли, она проверяет, чтобы введенное значение было именно числом и лежало в диапазоне от 1 до 10. Если данные валидны, то функция возвращает истину, если нет - ложь

Функция log отвечает за сохранение результатов игры. Она использует функцию appendFile модуля fs для записи данных. Если файл существует то результаты будут дописаны в существующий файл, если файла нет - он будет создан. Обратите внимание, что функция асинхронная и мы ожидаем выполнения операции сохранения результатов.

И наконец мы подошли к основной функции game. Внутри происходит вызов метода

rl.question(
    'Введите число от 1 до 10, чтобы угадать задуманное: '.yellow,
    (value) => {...});

который прослушивает консоль и при вводе значения вызывает callback функцию, которая обрабатывает введенное значение.

Если мы не проходим валидацию, то запускаем функцию игры заново:

let a = +value;
if (!isValid(a)) {
  game();
  return;
}

Если валидация пройдена, то мы увеличиваем счётчик попыток на 1. Дальше мы сравниваем введенное значение с «задуманным». Если число угадано, то мы выводим поздравление и количество попыток, затраченное на игру, потом с помощью функции log сохраняем результат в файле, и поскольку функция возвращает промис мы в методе finally закрываем интерфейс ввода rl.close(), если же результат не совпал, выполняем рекурсию до тех пор пока число не будет отгадано.

